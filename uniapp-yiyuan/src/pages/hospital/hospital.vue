<template>
  <view class="container">
    <!-- ç¬¬ä¸€ä¸ªåŒ»é™¢ï¼šdgutå¸‚ç¬¬ä¸€äººæ°‘åŒ»é™¢ -->
    <view class="hospital-card">
      <!-- å›¾ç‰‡å®¹å™¨å›ºå®šåœ¨é¡¶éƒ¨ -->
      <view class="image-container">
        <image src="/static/yiyuan2.jpg" mode="widthFix" class="hospital-img"></image>
        <view class="image-overlay"></view>
      </view>
      
      <!-- å†…å®¹å®¹å™¨ï¼Œé€šè¿‡ translateY å®ç°æ»‘åŠ¨è¦†ç›–æ•ˆæœ -->
      <view
        class="content-container"
        :style="{ transform: `translateY(${offsetY}px)` }"
        @touchstart="onTouchStart"
        @touchmove="onTouchMove"
        @touchend="onTouchEnd"
      >
        <view class="hospital-header">
          <view class="hospital-name">dgutå¸‚ç¬¬ä¸€äººæ°‘åŒ»é™¢</view>
          <view class="hospital-level">ä¸‰çº§ç”²ç­‰ Â· ç»¼åˆåŒ»é™¢</view>
          <view class="hospital-tag">
            <text class="tag">åŒ»ä¿å®šç‚¹</text>
            <text class="tag">ä¸‰ç”²åŒ»é™¢</text>
          </view>
        </view>

        <view class="hospital-info">
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ“‹</text>
            </view>
            <view class="info-content">
              <text class="label">åŒ»é™¢ç®€ä»‹ï¼š</text>
              <text class="value">dgutå¸‚ç¬¬ä¸€äººæ°‘åŒ»é™¢å§‹å»ºäº1950å¹´ï¼Œæ˜¯ä¸€æ‰€é›†åŒ»ç–—ã€æ•™å­¦ã€ç§‘ç ”ã€é¢„é˜²ä¸ºä¸€ä½“çš„ä¸‰çº§ç”²ç­‰ç»¼åˆåŒ»é™¢ï¼Œå¼€æ”¾åºŠä½1500å¼ ï¼Œå¹´é—¨è¯Šé‡è¶…200ä¸‡äººæ¬¡ã€‚</text>
            </view>
          </view>
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ“</text>
            </view>
            <view class="info-content">
              <text class="label">åœ°å€ï¼š</text>
              <text class="value">dgutå¸‚gyåŒº18è·¯510å·</text>
            </view>
          </view>
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ“</text>
            </view>
            <view class="info-content">
              <text class="label">è”ç³»ç”µè¯ï¼š</text>
              <text class="value">066-34567890</text>
            </view>
          </view>
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ•’</text>
            </view>
            <view class="info-content">
              <text class="label">è¥ä¸šæ—¶é—´ï¼š</text>
              <text class="value">å‘¨ä¸€è‡³å‘¨æ—¥ 08:00-18:30ï¼ˆæ€¥è¯Šç§‘24å°æ—¶ï¼‰</text>
            </view>
          </view>
        </view>
        
        <view class="action-buttons">
          <button class="btn btn-primary" @click="navigateTo('/pages/register/register')">é¢„çº¦æŒ‚å·</button>
        </view>
      </view>
    </view>

    <!-- ç¬¬äºŒä¸ªåŒ»é™¢ï¼šdgutå¸‚ä¸­åŒ»é™¢ -->
    <view class="hospital-card">
      <!-- å›¾ç‰‡å®¹å™¨å›ºå®šåœ¨é¡¶éƒ¨ -->
      <view class="image-container">
        <image src="/static/yiyuan1.jpg" mode="widthFix" class="hospital-img"></image>
        <view class="image-overlay"></view>
      </view>
      
      <!-- å†…å®¹å®¹å™¨ï¼Œé€šè¿‡ translateY å®ç°æ»‘åŠ¨è¦†ç›–æ•ˆæœ -->
      <view
        class="content-container"
        :style="{ transform: `translateY(${offsetY_2}px)` }"
        @touchstart="(e) => onTouchStart(e, 2)"
        @touchmove="(e) => onTouchMove(e, 2)"
        @touchend="(e) => onTouchEnd(e, 2)"
      >
        <view class="hospital-header">
          <view class="hospital-name">dgutå¸‚ä¸­åŒ»é™¢</view>
          <view class="hospital-level">ä¸‰ç”² Â· ä¸­åŒ»åŒ»é™¢</view>
          <view class="hospital-tag">
            <text class="tag">åŒ»ä¿å®šç‚¹</text>
            <text class="tag">ä¸‰ç”²åŒ»é™¢</text>
            <text class="tag">ä¸­åŒ»ç‰¹è‰²</text>
          </view>
        </view>

        <view class="hospital-info">
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ“‹</text>
            </view>
            <view class="info-content">
              <text class="label">åŒ»é™¢ç®€ä»‹ï¼š</text>
              <text class="value">dgutå¸‚ä¸­åŒ»é™¢å§‹å»ºäº1965å¹´ï¼Œæ˜¯é›†åŒ»ç–—ã€æ•™å­¦ã€ç§‘ç ”ã€é¢„é˜²ä¿å¥ã€åº·å¤äºä¸€ä½“çš„ä¸‰çº§ç”²ç­‰ä¸­åŒ»åŒ»é™¢ï¼Œæ˜¯å…¨å›½ç¤ºèŒƒä¸­åŒ»åŒ»é™¢ï¼Œå¼€æ”¾åºŠä½1200å¼ ï¼Œå¹´é—¨è¯Šé‡è¶…150ä¸‡äººæ¬¡ã€‚</text>
            </view>
          </view>
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ“</text>
            </view>
            <view class="info-content">
              <text class="label">åœ°å€ï¼š</text>
              <text class="value">dgutå¸‚gxåŒº4è·¯200å·</text>
            </view>
          </view>
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ“</text>
            </view>
            <view class="info-content">
              <text class="label">è”ç³»ç”µè¯ï¼š</text>
              <text class="value">066-87654321</text>
            </view>
          </view>
          <view class="info-item">
            <view class="icon-box">
              <text class="icon">ğŸ•’</text>
            </view>
            <view class="info-content">
              <text class="label">è¥ä¸šæ—¶é—´ï¼š</text>
              <text class="value">å‘¨ä¸€è‡³å‘¨å…­ 08:00-17:30ï¼Œå‘¨æ—¥ 08:30-16:30ï¼ˆä¸­åŒ»æ€¥è¯Šç§‘24å°æ—¶ï¼‰</text>
            </view>
          </view>
        </view>
        
        <view class="action-buttons">
          <button class="btn btn-primary" @click="navigateTo('/pages/register/register')">é¢„çº¦æŒ‚å·</button>
         
        </view>
      </view>
    </view>
  </view>  
</template>

<script>
export default {
  data() {
    return {
      startY: 0,
      offsetY: 0, // å½“å‰æ»‘åŠ¨åç§»é‡
      maxOffset: 0, // æœ€å¤§ä¸Šæ»‘è·ç¦»ï¼ˆè´Ÿå€¼ï¼‰
      minOffset: 0, // æœ€å¤§ä¸‹æ»‘è·ç¦»ï¼ˆ0ï¼‰
      startY_2: 0,
      offsetY_2: 0,
      maxOffset_2: 0,
      minOffset_2: 0,
    };
  },
  onLoad() {
    const systemInfo = uni.getSystemInfoSync();
    const rpxToPx = systemInfo.windowWidth / 750;
    const imageHeight = 600 * rpxToPx; // 600rpx è½¬ px
    this.maxOffset = -(imageHeight * 2 / 3); // æœ€å¤šä¸Šæ»‘ 2/3
    this.maxOffset_2 = -(imageHeight * 2 / 3);
  },
  methods: {
    onTouchStart(e, index = 1) {
      if (index === 1) {
        this.startY = e.touches[0].clientY;
      } else {
        this.startY_2 = e.touches[0].clientY;
      }
    },
    onTouchMove(e, index = 1) {
      if (index === 1) {
        const deltaY = e.touches[0].clientY - this.startY;
        let newOffset = this.offsetY + deltaY;

        // é™åˆ¶èŒƒå›´
        if (newOffset > this.minOffset) newOffset = this.minOffset;
        if (newOffset < this.maxOffset) newOffset = this.maxOffset;

        this.offsetY = newOffset;
        this.startY = e.touches[0].clientY;
      } else {
        const deltaY = e.touches[0].clientY - this.startY_2;
        let newOffset = this.offsetY_2 + deltaY;

        // é™åˆ¶èŒƒå›´
        if (newOffset > this.minOffset_2) newOffset = this.minOffset_2;
        if (newOffset < this.maxOffset_2) newOffset = this.maxOffset_2;

        this.offsetY_2 = newOffset;
        this.startY_2 = e.touches[0].clientY;
      }
    },
        checkUserInfo() {
      const userInfo = uni.getStorageSync('userInfo');
      // æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ userInfoï¼Œå¹¶ä¸” nickName å’Œ avatarUrl ä¸ä¸ºç©º
      if (userInfo && userInfo.nickName && userInfo.avatarUrl) {
        return true;
      }
      return false;
    },

    onTouchEnd(e, index = 1) {
      // å¯é€‰ï¼šæƒ¯æ€§æ»‘åŠ¨æˆ–å›å¼¹åŠ¨ç”»
    },
   navigateTo(targetUrl) {
      // 1. å…ˆæ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
      if (!this.checkUserInfo()) {
        // 2. å¦‚æœä¿¡æ¯ä¸å®Œæ•´ï¼Œå¼¹å‡ºæç¤º
        uni.showModal({
          title: 'æç¤º',
          content: 'è¯·å…ˆåœ¨â€œæˆ‘çš„â€é¡µé¢æˆæƒæ‚¨çš„ä¸ªäººä¿¡æ¯',
          showCancel: false, // ä¸æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®ï¼Œå¼ºåˆ¶ç”¨æˆ·å‰å¾€
          confirmText: 'å‰å¾€æˆæƒ',
          success: (res) => {
            if (res.confirm) {
              // 3. ç”¨æˆ·ç‚¹å‡»ç¡®è®¤åï¼Œè·³è½¬åˆ°â€œæˆ‘çš„â€é¡µé¢
              // æ³¨æ„ï¼šè¯·ç¡®ä¿ '/pages/mine/mine' æ˜¯ä½ â€œæˆ‘çš„â€é¡µé¢çš„æ­£ç¡®è·¯å¾„
              uni.switchTab({
                url: '/pages/mine/mine' 
              });
            }
          }
        });
        // 4. ç»ˆæ­¢åç»­çš„è·³è½¬æ“ä½œ
        return;
      }

      // 5. å¦‚æœä¿¡æ¯å®Œæ•´ï¼Œåˆ™æ‰§è¡ŒåŸæ¥çš„è·³è½¬é€»è¾‘
      uni.navigateTo({
        url: targetUrl,
        success: () => {
          console.log(`è·³è½¬è‡³ ${targetUrl} æˆåŠŸ`);
        },
        fail: (err) => {
          console.error('è·³è½¬å¤±è´¥ï¼š', err);
          uni.redirectTo({ url: targetUrl });
        }
      });
    }
  }
};

</script>

<style scoped>
.container {
  background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
  min-height: 100vh;
  padding: 20rpx;
  box-sizing: border-box;
}

.hospital-card {
  background-color: #fff;
  border-radius: 24rpx;
  box-shadow: 0 10rpx 30rpx rgba(0, 0, 0, 0.08);
  margin-bottom: 40rpx;
  overflow: hidden;
  position: relative;
}

/* å›¾ç‰‡å®¹å™¨å›ºå®šåœ¨é¡¶éƒ¨ */
.image-container {
  position: relative;
  width: 100%;
  height: 600rpx;
  overflow: hidden;
}

.hospital-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 120rpx;
  background: linear-gradient(to top, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 100%);
}

/* å†…å®¹å®¹å™¨ï¼Œåˆå§‹ä½ç½®åœ¨å›¾ç‰‡ä¸‹æ–¹ */
.content-container {
  position: relative;
  z-index: 2;
  transition: transform 0.1s ease-out;
  background-color: #fff;
  border-radius: 24rpx 24rpx 0 0;
  margin-top: -40rpx;
}

.hospital-header {
  background-color: #fff;
  padding: 40rpx 30rpx 30rpx;
  border-radius: 24rpx 24rpx 0 0;
  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.03);
}

.hospital-name {
  font-size: 44rpx;
  font-weight: bold;
  margin-bottom: 12rpx;
  color: #1a1a1a;
  letter-spacing: 1rpx;
}

.hospital-level {
  font-size: 32rpx;
  color: #4a90e2;
  margin-bottom: 20rpx;
  font-weight: 500;
}

.hospital-tag {
  display: flex;
  flex-wrap: wrap;
  gap: 16rpx;
}

.tag {
  font-size: 24rpx;
  color: #4a90e2;
  background-color: rgba(74, 144, 226, 0.1);
  padding: 8rpx 20rpx;
  border-radius: 40rpx;
  border: 1rpx solid rgba(74, 144, 226, 0.2);
}

.hospital-info {
  background-color: #fff;
  padding: 0 30rpx 30rpx;
}

.info-item {
  margin-bottom: 40rpx;
  display: flex;
  align-items: flex-start;
  padding: 20rpx 0;
  border-bottom: 1rpx solid #f0f0f0;
}

.info-item:last-child {
  border-bottom: none;
}

.icon-box {
  width: 60rpx;
  height: 60rpx;
  border-radius: 50%;
  background-color: rgba(74, 144, 226, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 24rpx;
  flex-shrink: 0;
}

.icon {
  font-size: 32rpx;
}

.info-content {
  flex: 1;
}

.label {
  font-size: 32rpx;
  color: #333;
  font-weight: 500;
  display: block;
  margin-bottom: 12rpx;
}

.value {
  font-size: 30rpx;
  color: #666;
  line-height: 1.6;
  display: block;
}

.action-buttons {
  display: flex;
  padding: 30rpx;
  gap: 20rpx;
  background-color: #f9fafc;
  border-top: 1rpx solid #f0f0f0;
}

.btn {
  flex: 1;
  height: 80rpx;
  border-radius: 40rpx;
  font-size: 32rpx;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.btn-primary {
  background-color: #4a90e2;
  color: white;
  border: none;
}

.btn-primary:active {
  background-color: #3a7bc8;
  transform: scale(0.98);
}

.btn-secondary {
  background-color: white;
  color: #4a90e2;
  border: 1rpx solid #4a90e2;
}

.btn-secondary:active {
  background-color: rgba(74, 144, 226, 0.05);
  transform: scale(0.98);
}
</style>